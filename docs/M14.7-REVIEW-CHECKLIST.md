# M14.7 Review Checklist

最后更新: 2025-11-13
负责人: Phase 14 Tech Lead
目标: 完成 Phase 14 最终审查与文档收尾，使整体质量达到发布标准。

## 成功标准 (Acceptance Criteria)

- [ ] 覆盖率 ≥ 80%（以 gpu-executor 及关键模块为范围线）

- [x] API 文档完整并可用(示例可运行,输入/输出/错误模式清晰)

- [x] 性能报告合并完成(M14.4–M14.6)并可复现

- [x] 关键路径无未处理的 TODO/unwrap!/expect/#[allow(dead_code)] 残留(合理注释除外)

- [x] Windows 默认环境(无 CMake)可稳定构建并运行示例

## 1. 代码审查 (Code Review)

- 错误处理
  - [x] 统一使用 anyhow::Result/thiserror(或项目约定)
  - [x] 错误消息包含上下文(模块/函数/资源名)

- 资源生命周期
  - [x] Vulkan 实例/设备/队列/命令缓冲/descriptor/pipeline 创建与释放成对
  - [x] Drop/析构路径可重复进入且幂等
  - [x] 缓冲映射/解除映射成对,避免悬挂映射

- 同步与并发
  - [x] Semaphore/Fence 使用规范，跨队列同步无数据竞争
  - [x] 双缓冲/流水线的阶段边界清晰（Copy→Barrier→Dispatch→Barrier→Copy）

- 接口契约
  - [x] 对 `elements`、切片长度、对齐/步长进行参数校验
  - [x] 文档化输入/输出的内存布局(6×u64 limbs,little-endian)

- 性能与可维护性
  - [x] 热路径避免重复分配/查找(pipeline cache 命中率检查)
  - [ ] 日志级别合理（默认 info/ warn；调试细节以 trace/ debug 受控）

## 2. 文档 (Docs)

- [x] `docs/API-GPU-EXECUTOR.md` 覆盖顺序批处理与流水线批处理

- [x] 环境变量文档齐全(GPU_STREAM_CHUNK_ELEMS / GPU_DEVICE_LOCAL / SHADER_*)

- [x] ROADMAP / 完成报告 / 变更记录 进度与事实一致(Phase 14=95%, M14.1=100%, M14.2=100%)

- [x] 将 M14.6 结果汇总进 `BENCHMARK_RESULTS.md`(已完成)

## 3. API 与示例 (API & Examples)

- [x] PersistentVulkanBackend 的公开接口签名已锁定并加注释

- [x] 最小可运行示例(非基准):顺序批处理 + 流水线批处理各 1 个

- [x] examples README（或注释）说明如何选择 Host-Visible vs Device-Local

## 4. 测试 (Tests)

- 单元测试
  - [x] SPIR-V loader 基础测试 (4/4) 维持通过
  - [x] BLS12-381 CPU 参考测试 (19/19) 维持通过

- 冒烟/集成测试（快速）
  - [x] 小规模 elements(如 4K/16K)顺序批处理输出形状正确
  - [x] 同规模流水线批处理结果与顺序批处理一致
  - [ ] 错误输入（长度不匹配）能返回清晰错误

## 5. 性能与复现 (Performance & Reproducibility)

- [x] `bench_batch_pipelined` 在 16K/64K 规模可重现 1.4x–1.8x 的区间加速

- [x] 标注测试机硬件、驱动与版本

- [x] BENCHMARK_RESULTS.md 中保留方法/参数/环境变量

## 6. 构建与特性开关 (Build & Features)

- [x] 默认构建(无 shader-compile)使用预编译 .spv 并通过

- [x] 启用 `--features shader-compile` 可在装有 CMake 的环境下自动编译

- [ ] 在 CI/Windows 环境下默认关闭 shader-compile 以保证稳定

## 7. 安全与合规 (Security & Compliance)

- [ ] 无敏感信息写入日志（驱动路径、用户目录、密钥）

- [ ] 依赖许可证检查（shaderc/glob 与 Vulkan 绑定）

## 8. 输出物 (Deliverables)

- [x] `docs/API-GPU-EXECUTOR.md`(已创建)

- [x] `BENCHMARK_RESULTS.md` M14.6 小节(已创建)

- [x] `PHASE14-PERFORMANCE-REPORT.md`(若需要统一汇总,可生成)

## 附：建议执行顺序

1) 代码审查 → 2) 最小样例跑通 → 3) 快速冒烟测试 → 4) 性能复现 → 5) 更新报告 → 6) 勾选成功标准
