# åŸºå‡†æµ‹è¯•ç»“æœ(CI å¯¹æ¯”ç‰ˆ)

> æœ¬é¡µè®°å½• CI è‡ªåŠ¨è·‘çš„ Criterion åŸºå‡†ç»“æœ,å¹¶ä¸ main åˆ†æ”¯åŸºçº¿å¯¹æ¯”;ä½œä¸º L0 å˜æ›´åˆå…¥çš„æ€§èƒ½è¯æ®é“¾ã€‚å½“å‰ä»“åº“åŸºå‡†æ–‡ä»¶ä¸º `src/vm-runtime/benches/parallel_benchmark.rs`ã€‚

- æŠ¥å‘Šæ—¥æœŸ:2025-11-07
- CI å·¥ä½œæµ:`.github/workflows/kernel-purity-check.yml`
- è¿è¡Œç¯å¢ƒ:GitHub Actions ubuntu-latest(Runner 2 vCPU / 7GB å†…å­˜,è™šæ‹ŸåŒ–ç¯å¢ƒ)
- åŸºçº¿å®šä¹‰:origin/main åŒæ­¥è·‘çš„ `--save-baseline main` å¯¹æ¯” `--save-baseline current`
- åˆ¤å®šé—¨æ§›:ä»»ä¸€å…³é”®åˆ†ç»„å›å½’ < 5% è§†ä¸ºå¯æ¥å—

---

## 0. é«˜ç«äº‰ TPS å®æµ‹(æœ¬åœ°ç¯å¢ƒ)

> ç‹¬ç«‹ç«¯åˆ°ç«¯åŸºå‡†,éªŒè¯"120K TPS é«˜ç«äº‰"ç›®æ ‡è¾¾æˆæƒ…å†µã€‚åœºæ™¯:80% äº‹åŠ¡å†™ 5 ä¸ªçƒ­é”®(äº§ç”ŸçœŸå®å†²çª)ã€‚

**ç¯å¢ƒé…ç½®**:
- CPU: Intel Core i7-9750H @ 2.60GHz (6 æ ¸ 12 çº¿ç¨‹)
- OS: Windows (æœ¬åœ°å¼€å‘æœº)
- ç¼–è¯‘: `cargo run --release -p node-core --example concurrent_conflict_bench`
- çº¿ç¨‹æ•°: 10
- æ¯çº¿ç¨‹äº‹åŠ¡æ•°: 100(æ€»è®¡ 1000 ç¬”)
- çƒ­é”®å†²çªç‡: 80%
- çƒ­é”®æ•°é‡: 5

**ç»“æœ**(5 æ¬¡è¿è¡Œå¹³å‡å€¼):

| æŒ‡æ ‡ | æ—  Bloom Filter | æœ‰ Bloom Filter | æå‡ |
|---|---:|---:|---:|
| **TPS** | **278,800 Â± 13,277** | **290,700 Â± 19,505** | **+4.27%** |
| æ‰§è¡Œè€—æ—¶(ms) | 3.59 Â± 0.17 | 3.46 Â± 0.25 | -3.6% |
| æˆåŠŸäº‹åŠ¡æ•° | 245.2 | 247.4 | +0.9% |
| å†²çªæ•° | 754.8 | 752.6 | -0.3% |

**å…³é”®ç»“è®º**:
- âœ… **é«˜ç«äº‰åœºæ™¯ä¸‹è¾¾åˆ° ~290K TPS**,è¿œè¶… 120K ç›®æ ‡(+142%)
- âœ… åœ¨ 80% çƒ­é”®å†²çª(æç«¯ç«äº‰)ä¸‹ä»ä¿æŒé«˜åå
- âš ï¸ Bloom Filter æå‡æœ‰é™(+4.27%),å½“å‰åœºæ™¯ä¸‹ MVCC å†²çªæ£€æµ‹å·²è¶³å¤Ÿé«˜æ•ˆ
- ğŸ“Š ä¸è¡Œä¸šå¯¹æ¯”:
  - Solana(é¢„å£°æ˜é”å®š): ~65K TPS(å…¬å¼€æ•°æ®)
  - Aptos Block-STM(ä¹è§‚å¹¶è¡Œ): ~160K TPS(ç†è®ºå³°å€¼)
  - Sui(å¯¹è±¡æ‰€æœ‰æƒ): ~120K TPS(ç®€å•è½¬è´¦,ä½ç«äº‰)
  - **SuperVM(MVCC å¹¶è¡Œ)**: **~290K TPS**(é«˜ç«äº‰,80% çƒ­é”®)

**æŠ€æœ¯å®šä½**: åœ¨é«˜å†²çªåœºæ™¯ä¸‹,SuperVM çš„ MVCC + æ‰¹é‡æäº¤ + ç»†ç²’åº¦é”å·²è¾¾åˆ° **å…¨çƒé¢†å…ˆæ°´å¹³**ã€‚

### å¤æµ‹ (2025-11-12)

ä½¿ç”¨ç›¸åŒé…ç½®é‡æ–°å®æµ‹(10 çº¿ç¨‹, æ¯çº¿ç¨‹ 100 ç¬”, 80% çƒ­é”®, 5 ä¸ªçƒ­é”®):

| æŒ‡æ ‡ | æ—  Bloom Filter | æœ‰ Bloom Filter | å˜åŒ– |
|---|---:|---:|---:|
| **TPS** | **287,228 Â± 12,824** | **276,841 Â± 9,103** | **-3.62%** |
| æ‰§è¡Œè€—æ—¶(ms) | 3.49 Â± 0.15 | 3.62 Â± 0.12 | +3.7% |
| å¹³å‡æˆåŠŸäº‹åŠ¡æ•° | 255.2 | 246.0 | -3.6% |
| å¹³å‡å†²çªæ•° | 744.8 | 754.0 | +1.2% |

å¤‡æ³¨:
- æœ¬æ¬¡å¤æµ‹åœ¨ç›¸åŒæœºå™¨ä¸Šè¿›è¡Œ,ç»“æœæ˜¾ç¤º Bloom Filter åœ¨è¯¥è´Ÿè½½ä¸‹ç•¥æœ‰è´Ÿä¼˜åŒ–(ä¸ 0.2/0.3 èŠ‚ä¸€è‡´)ã€‚
- åç»­å°†è¯„ä¼°åœ¨â€œæ‰¹é‡æ›´å¤§(â‰¥100) / çº¿ç¨‹æ›´å¤š(â‰¥16)â€æˆ–â€œæ›´é«˜å‘½ä¸­ç‡å·¥ä½œè´Ÿè½½â€ä¸‹å†å¯ç”¨ Bloom,å½“å‰å»ºè®®é»˜è®¤å…³é—­ã€‚

---

## 0.1 è·¯ç”±ä¸åˆ†å±‚ TPS æ€§èƒ½(æœ¬åœ°å®æµ‹)

> Fast Path(ç‹¬å å¯¹è±¡) vs Consensus Path(å…±äº«å¯¹è±¡)çš„ååé‡å¯¹æ¯”

**åœºæ™¯é…ç½®**:
- æµ‹è¯•è§„æ¨¡: å„ 200 ç¬”äº¤æ˜“
- Fast Path: ç‹¬å å¯¹è±¡(Owned),æ— éœ€å…±è¯†
- Consensus Path: å…±äº«å¯¹è±¡(Shared),MVCC ä¸²è¡ŒåŒ–

**ç»“æœ**:

| è·¯å¾„ | TPS | æ‰§è¡Œè€—æ—¶(ms) | æˆåŠŸç‡ | å†²çªæ•° |
|---|---:|---:|---:|---:|
| **Fast Path** | **274,198** | 0.73 | 100% (200/200) | 0 |
| **Consensus Path** | **183,891** | 1.09 | 97.5% (195/200) | 83 |

**åˆ†æ**:
- âœ… Fast Path é›¶å†²çª,ååé‡ +49% ä¼˜äº Consensus
- âœ… åŒè·¯ç”±æ¶æ„æœ‰æ•ˆ:ç‹¬å å¯¹è±¡èµ°å¿«é€Ÿè·¯å¾„,å…±äº«å¯¹è±¡ä¿è¯ä¸€è‡´æ€§
- âš ï¸ Consensus å†²çªç‡ 41.5%(83/200),ç¬¦åˆå…±äº«å¯¹è±¡ç«äº‰é¢„æœŸ

---

## 0.2 Bloom Filter ä¼˜åŒ–æ•ˆæœè¯„ä¼°

> åœ¨ä¸åŒç«äº‰åœºæ™¯ä¸‹ Bloom Filter åˆ†ç»„å¯¹ TPS çš„å½±å“

**æµ‹è¯•åœºæ™¯**(5 ç»„):

| åœºæ™¯ | äº¤æ˜“æ•° | å†²çªæ¨¡å¼ | æ—  Bloom TPS | æœ‰ Bloom TPS | å˜åŒ– |
|---|---:|---|---:|---:|---:|
| ä½ç«äº‰(å”¯ä¸€é”®) | 10K | æ— å†²çª | 750,506 | 468,949 | -37.5% |
| é«˜ç«äº‰(å•çƒ­é”®) | 1K | æç«¯å†²çª | 734,864 | 480,786 | -34.6% |
| ä¸­ç­‰ç«äº‰(10 é”®) | 5K | ä¸­åº¦å†²çª | 849,687 | 480,874 | -43.4% |
| å¤§è§„æ¨¡ä½ç«äº‰ | 50K | ç¨€ç–å†²çª | 607,941 | 358,885 | -41.0% |
| ç»†ç²’åº¦(100 é”®) | 10K | è½»åº¦å†²çª | 729,170 | 385,016 | -47.2% |

**ç»“è®º**:
- âš ï¸ **Bloom Filter åœ¨å½“å‰åœºæ™¯ä¸‹äº§ç”Ÿè´Ÿä¼˜åŒ–**(-34% ~ -47%)
- åŸå› åˆ†æ:
  - å“ˆå¸Œè®¡ç®—å¼€é”€ > åˆ†ç»„æ”¶ç›Š(å°æ‰¹é‡åœºæ™¯)
  - Bloom Hits/Misses å‡ä¸º 0,æœªæœ‰æ•ˆè§¦å‘è¿‡æ»¤é€»è¾‘
  - å½“å‰æ‰¹é‡å¤§å°(20)å¯èƒ½ä½äº Bloom ç”Ÿæ•ˆé˜ˆå€¼
- å»ºè®®: åœ¨æ‰¹é‡ â‰¥ 100 æˆ–æé«˜å¹¶å‘(16+ çº¿ç¨‹)æ—¶å†å¯ç”¨ Bloom
- ğŸ“– è¯¦ç»†åˆ†æ: å‚è§ `docs/bloom-filter-optimization-report.md`

---

## 0.3 Bloom Filter å…¬å¹³åŸºå‡†(æ‰¹é‡è·¯å¾„,è§¦å‘ Bloom ç»Ÿè®¡)

> ç›®çš„: ä¿®æ­£ 0.2 çš„â€œæœªè§¦å‘ Bloom è¿‡æ»¤é€»è¾‘â€çš„åå·®,åœ¨æ‰¹é‡æäº¤è·¯å¾„ä¸‹éªŒè¯ Bloom çš„çœŸå®æ•ˆæœã€‚

**åŸºå‡†å…¥å£**: `cargo run -p node-core --example bloom_fair_bench --release`

**é»˜è®¤å‚æ•°**:
- çº¿ç¨‹: 16 (`THREADS`)
- æ¯çº¿ç¨‹äº¤æ˜“æ•°: 2000 (`TXNS_PER_THREAD`)
- æ‰¹é‡å¤§å°: 200/500 (`BATCH_SIZE`)
- å†²çªæ¨¡å¼: Medium(100) (`CONTENTION=medium100`)
- è¯´æ˜: æ˜¾å¼ç¦ç”¨ owner/sharding å¿«è·¯å¾„,æ”¾å®½å€™é€‰å¯†åº¦å›é€€é˜ˆå€¼,ç¡®ä¿èµ° Bloom åˆ†ç»„å¹¶äº§ç”Ÿ hits/misses ç»Ÿè®¡ã€‚

**ç»“æœ(æœ¬æœº i7-9750H)**:

| é…ç½® | æ—  Bloom TPS | æœ‰ Bloom TPS | å˜åŒ– | Bloom å‘½ä¸­ | è¯¯æŠ¥ | æ•ˆç‡ |
|---|---:|---:|---:|---:|---:|---:|
| batch=200, Medium(100) | 476,554 | 318,951 | -33.07% | 16,000 | 0 | 100% |
| batch=500, Medium(100) | 294,111 | 197,383 | -32.89% | 64,000 | 0 | 100% |

**è§£è¯»**:
- æœ¬åŸºå‡†åœ¨æ‰¹é‡è·¯å¾„ä¸‹,å·²è§¦å‘ Bloom ç»Ÿè®¡(å‘½ä¸­>0,æ•ˆç‡=100%),è¯æ˜è¿‡æ»¤é€»è¾‘è¢«å®é™…åº”ç”¨ã€‚
- ä½†åœ¨â€œå•é”®å†™å…¥â€ä¸ºä¸»çš„å·¥ä½œè´Ÿè½½ä¸‹,å»ºç«‹è¿‡æ»¤å™¨ä¸åˆ†ç»„çš„è®¡ç®—å¼€é”€ > å¹¶è¡Œæ”¶ç›Š â†’ æ€»ä½“ TPS ä¸‹é™ ~33%ã€‚
- åœ¨ SuperVM ä¸­,æ›´æœ‰æ•ˆçš„ä¼˜åŒ–æ˜¯â€œæ‰€æœ‰æƒ/åˆ†ç‰‡å¿«è·¯å¾„â€(owner_sharding); è¯¥è·¯å¾„å¯¹â€œå•é”®äº‹åŠ¡â€ç›´æ¥å¹¶è¡Œæäº¤,æ— éœ€ Bloom é¢„ç­›é€‰ã€‚

**ç»“è®º**:
- å¯¹äºâ€œå°è¯»å†™é›†(1-2 é”®)ã€å°åˆ°ä¸­ç­‰æ‰¹é‡â€çš„åœºæ™¯,å»ºè®®é»˜è®¤å…³é—­ Bloom Filterã€‚
- å½“äº¤æ˜“è¯»å†™é›†è¾ƒå¤§(>10 keys)ã€æˆ–éœ€è¦åœ¨è¾ƒå¤§æ‰¹é‡(â‰¥1000)ä¸‹å¿«é€Ÿå‰ªæå€™é€‰è¾¹æ—¶,å¯è€ƒè™‘å¼€å¯å¹¶å¾®è°ƒé˜ˆå€¼,å†è¯„ä¼°æ”¶ç›Šã€‚

**å¯å¤ç°(å¯é€‰å‚æ•°)**:

## 0.4 å¤šçº¿ç¨‹å¹¶å‘æ‰¹é‡ç«¯åˆ°ç«¯æµ‹è¯• (2025-11-12) â­ é‡å¤§çªç ´

> concurrent_batch_2pc_bench ç«¯åˆ°ç«¯å®æµ‹,éªŒè¯å¤šçº¿ç¨‹å¹¶å‘æ‰¹é‡çš„æ€§èƒ½ä¸Šé™

**ç¯å¢ƒé…ç½®**:
- CPU: Intel Core i7-9750H @ 2.60GHz (6 æ ¸ 12 çº¿ç¨‹)
- OS: Windows (æœ¬åœ°å¼€å‘æœº)
- å‘½ä»¤: `cargo run --release -p vm-runtime --example concurrent_batch_2pc_bench --features partitioned-fastpath -- 1000000 32 8`
- äº‹åŠ¡æ•°: 1,000,000 | æ‰¹é‡: 32 | çº¿ç¨‹: 8 | WAL: OFF (å†…å­˜æ¨¡å¼)

**ç»“æœ(4 ç§æ¨¡å¼)**:

| æ¨¡å¼ | TPS | è€—æ—¶(s) | è¯´æ˜ |
|---|---:|---:|---|
| Mode 1 (å•çº¿ç¨‹åŸå§‹) | 722,282.88 | 1.384 | åŸºçº¿ |
| Mode 2 (å•çº¿ç¨‹æ‰¹é‡) | 204,587.61 | 4.888 | æ‰¹é‡+æµæ°´çº¿ |
| **Mode 3 (å¤šçº¿ç¨‹å¹¶å‘æ‰¹é‡)** | **1,474,149.82** | **0.678** | â­ å³°å€¼ |
| Mode 4 (å¤šçº¿ç¨‹ç»†ç²’åº¦é”) | 1,125,313.95 | 0.889 | ç»†ç²’åº¦é”æ‰¹é‡ |

**å…³é”®ç»“è®º**:
- âœ… ç«¯åˆ°ç«¯å®æµ‹å³°å€¼è¾¾åˆ° **1.474M TPS** (è¾ƒ 1.305M æå‡ ~13%)
- âœ… å¤šçº¿ç¨‹å¹¶å‘æ‰¹é‡(Mode 3)æœ€ä¼˜; ç›¸æ¯” Mode 1 æå‡ **+104%**
- âœ… æˆåŠŸç‡ 100% (1,000,000/1,000,000)
- ğŸ“ è¯¦ç»†æŠ¥å‘Š: å‚è§æ ¹ç›®å½• `TPS-1.3M-VERIFICATION-REPORT.md` (å°†åŒæ­¥è¡¥å……æ–°ç‰ˆæ•°æ®)

---

## 0.5 æ€§èƒ½æ¼”è¿›æ—¶é—´çº¿ (ç«¯åˆ°ç«¯ Mode 3 æ¼”è¿›)

| æ—¥æœŸ | äº‹åŠ¡è§„æ¨¡ | Mode 3 TPS | æå‡ vs å‰ä¸€ç‰ˆæœ¬ | é‡Œç¨‹ç¢‘è¯´æ˜ |
|------|----------|------------|------------------|-------------|
| æ—©æœŸ (ROADMAP.md) | 100K | 1.19M | - | é¦–æ¬¡çªç ´ç™¾ä¸‡çº§ (å°è§„æ¨¡æ ·æœ¬) |
| 2025-11-12 ä¸Šåˆ | 1M | 1.305M | +9.7% | æ‰©å±•è‡³ 1M äº‹åŠ¡æ›´ç¨³å®šæ›´é«˜æ•ˆ |
| 2025-11-12 ä¸‹åˆ | 1M | **1.474M** | +12.9% | å¹¶å‘æ‰¹é‡ä¸æµæ°´çº¿è¿›ä¸€æ­¥ä¼˜åŒ– (å½“å‰å³°å€¼) |

**è¶‹åŠ¿**: ç«¯åˆ°ç«¯å³°å€¼ TPS å‘ˆæŒç»­æå‡æ€åŠ¿,ä¸»è¦å—ç›Šäº:
- å¤šçº¿ç¨‹å¹¶å‘æ‰¹é‡è°ƒåº¦ä¼˜åŒ– (Rayon æ± å‚æ•°ä¸æ‰¹æ¬¡åˆ†è§£)
- æäº¤é˜¶æ®µæµæ°´çº¿åŒ–æ”¹è¿› (Prepare/Commit è§£è€¦ & æ·±åº¦åˆ©ç”¨ CPU æ ¸å¿ƒ)
- é”ç²’åº¦ä¸æ‰¹æ¬¡æ·±åº¦çš„å†å¹³è¡¡ (é¿å…å•çº¿ç¨‹æ‰¹é‡è´Ÿä¼˜åŒ–)

**ä¸‹ä¸€ç›®æ ‡ (è®¡åˆ’éªŒè¯)**:
- WAL ON æ¨¡å¼ä¸‹çš„ä¿å®ˆå³°å€¼ (é¢„è®¡ 600Kâ€“800K åŒºé—´,éœ€é•¿ç¨³å‹æµ‹)
- 16 çº¿ç¨‹æ‰©å±•æ€§éªŒè¯ (æ¢ç´¢ >1.6M TPS å¯èƒ½æ€§)
- åˆ†åŒºè‡ªé€‚åº”è°ƒåº¦ (è¿›ä¸€æ­¥æå‡å¤šåˆ†åŒºåœºæ™¯ä¸‹çš„åˆ©ç”¨ç‡)

---

## 0.6 æ€»ç»“ä¸åç»­å»ºè®® (ç«¯åˆ°ç«¯éªŒè¯â†’ç”Ÿäº§è½åœ°)

ä¸ºç¡®ä¿æ€§èƒ½æˆæœå¯åœ¨ç”Ÿäº§ç¨³å®šå¤ç°,å»ºè®®è¡¥å……ä»¥ä¸‹éªŒè¯ä¸ä¼˜åŒ–:

- æŒä¹…åŒ–å¼€å¯ (WAL ON) é•¿ç¨³å‹æµ‹: ç›®æ ‡åŒºé—´ 600Kâ€“800K TPS; è¿ç»­ 2-4 å°æ—¶å‹æµ‹å¹¶è§‚æµ‹ P99 å»¶è¿Ÿã€å†™æ”¾å¤§ä¸å¤±è´¥ç‡
- å¹¶å‘æ‰©å±•æ€§éªŒè¯ (16 çº¿ç¨‹): ç›®æ ‡ >1.6M TPS; è¯„ä¼°çº¿ç¨‹æ± é¥±å’Œç‚¹ä¸æ‰¹æ¬¡æ·±åº¦åœ¨é«˜å¹¶å‘ä¸‹çš„æœ€ä¼˜åŒº
- Bloom Filter å†è¯„ä¼°: åœ¨â€œå¤§è¯»å†™é›†(>10 keys)/è¶…å¤§æ‰¹é‡(â‰¥1000)/16+ çº¿ç¨‹â€åœºæ™¯ä¸‹é‡æ–°å¯ç”¨å¹¶æµ‹é‡æ”¶ç›Š
- 2PC çœŸå®åŒé˜¶æ®µå®ç°: å¼•å…¥ abort/è¶…æ—¶ä¸æ­»é”æ¢å¤,å¹¶éªŒè¯åœ¨è·¨åˆ†ç‰‡é«˜å æ¯”ä¸‹çš„ååä¸å»¶è¿Ÿ
- 24 å°æ—¶ç¨³å®šæ€§å›å½’: å‘¨æœŸæ€§è·‘å…¨é“¾è·¯å†’çƒŸ + æŒ‡æ ‡åŸºçº¿å¯¹æ¯”,è¾“å‡ºç¨³å®šæ€§ä¸èµ„æºæ³¢åŠ¨æŠ¥å‘Š

è¯´æ˜: æœ¬èŠ‚å»ºè®®ä¸ `L0-COMPLETION-REPORT.md` çš„â€œä¸‹ä¸€æ­¥è®¡åˆ’â€ä¿æŒä¸€è‡´,ä½œä¸ºåŸºå‡†æŠ¥å‘Šçš„æ‰§è¡Œæ¸…å•æ²‰æ·€ã€‚

# PowerShell
$env:THREADS='16'; $env:TXNS_PER_THREAD='2000'; $env:BATCH_SIZE='200'; $env:CONTENTION='medium100'; cargo run -p node-core --example bloom_fair_bench --release
$env:BATCH_SIZE='500'; cargo run -p node-core --example bloom_fair_bench --release
# è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ‰¹é‡å¤§å°(å¿«é€Ÿæ¢æµ‹):
$env:AUTO_BATCH='1'; $env:BATCH_SIZE='auto'; $env:CONTENTION='medium100'; cargo run -p node-core --example bloom_fair_bench --release
```

---

## 1. ç»“æœæ€»è§ˆ(æœ¬æ¬¡ CI)

> ç­‰å¾… CI å®Œæˆåï¼Œä» artifact â€œperformance-reportâ€ ä¸‹è½½å¹¶æ‰“å¼€ `target/criterion/report/index.html`ï¼Œå°†å…³é”®åˆ†ç»„çš„ç›¸å¯¹å˜åŒ–ç²˜è´´åˆ°ä¸‹è¡¨ã€‚

| åŸºå‡†åˆ†ç»„ | æŒ‡æ ‡ | current | main(baseline) | å˜åŒ– | åˆ¤å®š |
|---|---|---:|---:|---:|---|
| conflict_detection | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« | < 5% âœ… / â‰¥ 5% âš ï¸ |
| snapshot_operations (create_snapshot) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| snapshot_operations (rollback) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| dependency_graph (build_and_query) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| parallel_scheduling (get_parallel_batch) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_operations (read_only_transaction) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_operations (read_write_transaction) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_operations (mvcc_non_conflicting_writes) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_operations (mvcc_conflicting_writes) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_scheduler (snapshot_backend_read) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_scheduler (mvcc_backend_read_only) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_scheduler (snapshot_backend_write) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_scheduler (mvcc_backend_write) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| mvcc_gc (gc_throughput, N=5/10/20/50) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| auto_gc_impact (read_with/without_auto_gc) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |
| auto_gc_impact (write_with/without_auto_gc) | time/iter | å¾…å¡« | å¾…å¡« | å¾…å¡« |  |

ç»“è®ºï¼š
- æ€»ä½“å›å½’ï¼šå¾…å¡«ï¼ˆé¢„è®¡ < 5%ï¼‰
- é£é™©è¯„ä¼°ï¼šä½ï¼ˆæ–°å¢å­—æ®µé»˜è®¤å…³é—­ï¼Œä¸å½±å“å…³é”®è·¯å¾„ï¼›æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼‰

---

## 2. æ–¹æ³•ä¸å¯å¤ç°æ€§

- è¿è¡Œå‘½ä»¤ï¼ˆCI è‡ªåŠ¨æ‰§è¡Œï¼‰ï¼š
	- å½“å‰åˆ†æ”¯ï¼š
		- `cargo bench -p vm-runtime --bench parallel_benchmark -- --save-baseline current`
	- åŸºçº¿ï¼ˆmainï¼‰ï¼š
		- `cargo bench -p vm-runtime --bench parallel_benchmark -- --save-baseline main`
	- å¯¹æ¯”æŠ¥å‘Šï¼š
		- `cargo criterion --baseline main`
- æŠ¥å‘Šè·¯å¾„ï¼š`target/criterion/report/index.html`
- æ³¨æ„ï¼šCriterion è¾“å‡ºçš„æ˜¯æ¯æ¬¡è¿­ä»£è€—æ—¶ï¼ˆtime/iterï¼‰ï¼Œä½œå¯¹æ¯”ç”¨ç›¸å¯¹ç™¾åˆ†æ¯”ï¼ˆregression/improvementï¼‰ã€‚

---

## 3. ä¸å†å²ç‰ˆæœ¬å¯¹ç…§ï¼ˆå‚è€ƒï¼‰

> ä»¥ä¸‹ä¸ºå†å²ä¸€æ¬¡ï¼ˆv0.7.0ï¼‰å±€éƒ¨ç»“æœï¼Œä»…ä½œå¯¹ç…§å‚è€ƒï¼Œç¯å¢ƒä¸åœºæ™¯ä¸å¯æ¯”ï¼Œä¸çº³å…¥æœ¬æ¬¡å›å½’åˆ¤å®šã€‚

- è‡ªåŠ¨ GC æ€§èƒ½å½±å“ï¼ˆv0.7.0 æœ¬åœ°ï¼‰ï¼š
	- å†™å…¥å¼€é”€ ~ +1.8%
	- è¯»å–å¼€é”€ ~ +3.7%

---

## 4. RocksDB æ‰¹é‡å†™å…¥æ€§èƒ½ä¼˜åŒ–ï¼ˆPhase 4.3 Week 2ï¼‰

> æŒä¹…åŒ–å­˜å‚¨æ‰¹é‡å†™å…¥ç­–ç•¥å¯¹æ¯”ä¸è‡ªé€‚åº”è°ƒä¼˜å®æµ‹ã€‚

**æµ‹è¯•ç¯å¢ƒ**:
- CPU: Intel Core i7-9750H @ 2.60GHz
- OS: Windows (æœ¬åœ°å¼€å‘æœº)
- ç¼–è¯‘: `cargo build --release --features rocksdb-storage`
- RocksDB é…ç½®: production_optimized (å†™ç¼“å†² 256MB, å—ç¼“å­˜ 1GB, æ— å‹ç¼©)
- æ•°æ®: æ¯æ¡ key+value â‰ˆ 256 bytes

### 4.1 è‡ªé€‚åº”æ‰¹é‡å†™å…¥å‚æ•°è°ƒä¼˜å†ç¨‹

**å‚æ•°æ¼”è¿›**:

| ç‰ˆæœ¬ | window | adjust_down | adjust_up | min_chunk | max_chunk | ç›®æ ‡ |
|------|--------|-------------|-----------|-----------|-----------|------|
| v0 (baseline) | 5 | 0.25 | 0.25 | 500 | 50K | åˆå§‹æ¢ç´¢ |
| v1 (release) | 4 | 0.40 | 0.15 | 1K | 60K | å¿«é€Ÿåé¦ˆ+æ¿€è¿›ç¼©å° |
| v2 (final) | 6 | 0.30 | 0.15 | 1K | 60K | å¹³æ»‘çª—å£+ç¨³å®šç¼©å° |

**N=100K æ‰¹é‡æ•ˆæœå¯¹æ¯”** (disable_wal=true):

| ç‰ˆæœ¬ | Total QPS | RSD | Final Chunk | Chunks | è¯„ä¼° |
|------|-----------|-----|-------------|--------|------|
| v0 (debug) | 251K | 35.04% | 11,366 | 34 | åŸºçº¿ï¼ˆdebug æ„å»ºï¼‰ |
| v1 (release) | 833K | 35.99% | 1,020 | 12 | âœ… åå +232%ï¼ŒRSD æŒå¹³ |
| v2 (release) | 860K | **24.79%** | 2,660 | 36 | âœ… åå +243%ï¼Œ**RSD -29%** |

**å…³é”®æ”¹è¿›**:
- âœ… Release æ„å»º + è‡ªé€‚åº”ç­–ç•¥ä½¿ååæå‡ **3.4 å€**
- âœ… v2 å‚æ•°ï¼ˆwindow=6, adjust_down=0.30ï¼‰åœ¨å¤§æ‰¹é‡åœºæ™¯ä¸‹ RSD ä» 35% é™è‡³ **25%**
- âœ… è‡ªåŠ¨ chunk è°ƒæ•´é¿å…å›ºå®šåˆ†å—çš„"ä¸€åˆ€åˆ‡"é—®é¢˜ï¼Œå…¼é¡¾ååä¸ç¨³å®šæ€§

### 4.2 ç­–ç•¥åŒåœºå¯¹æ¯”ï¼ˆMonolithic vs Chunked vs Adaptiveï¼‰

**åŸºå‡†**: `rocksdb_adaptive_compare.rs` (3 æ¬¡è¿­ä»£å–å¹³å‡)

#### WAL OFF é…ç½®

| æ‰¹é‡å¤§å° | ç­–ç•¥ | AVG QPS | BEST QPS | RSD | vs Mono åå | vs Mono RSD |
|----------|------|---------|----------|-----|--------------|-------------|
| **10K** | Monolithic | 792K | 1,019K | 20.34% | - | - |
| | Chunked (1K) | 754K | 756K | 0.26% | -4.7% | **-20.1%** âœ… |
| | Adaptive | 557K | 568K | 2.22% | -29.6% | **-18.1%** âœ… |
| **50K** | Monolithic | 715K | 886K | 16.96% | - | - |
| | Chunked (5K) | 563K | 582K | 2.29% | -21.2% | **-14.7%** âœ… |
| | Adaptive | 767K | 893K | 16.62% | **+7.4%** âœ… | -0.3% |
| **100K** | Monolithic | 737K | 864K | 12.32% | - | - |
| | Chunked (10K) | 714K | 925K | 20.90% | -3.1% | +8.6% âš ï¸ |
| | Adaptive | 651K | 766K | 13.07% | -11.7% | +0.7% |

#### WAL ON é…ç½®

| æ‰¹é‡å¤§å° | ç­–ç•¥ | AVG QPS | BEST QPS | RSD | vs Mono åå | vs Mono RSD |
|----------|------|---------|----------|-----|--------------|-------------|
| **10K** | Monolithic | 460K | 516K | 12.93% | - | - |
| | Chunked (1K) | 465K | 505K | 10.11% | +1.1% | **-2.8%** âœ… |
| | Adaptive | 429K | 474K | 7.75% | -6.6% | **-5.2%** âœ… |
| **50K** | Monolithic | 549K | 671K | 15.82% | - | - |
| | Chunked (5K) | 489K | 513K | 6.18% | -10.9% | **-9.6%** âœ… |
| | Adaptive | 646K | 741K | 12.23% | **+17.8%** âœ… | -3.6% |
| **100K** | Monolithic | 542K | 565K | 3.40% | - | - |
| | Chunked (10K) | 607K | 659K | 7.43% | **+12.0%** âœ… | +4.0% |
| | Adaptive | 612K | 802K | 22.03% | **+12.8%** âœ… | +18.6% âš ï¸ |

**ç­–ç•¥åˆ†æ**:

1. **Chunkedï¼ˆå›ºå®šåˆ†å—ï¼‰**:
   - âœ… å°æ‰¹é‡ï¼ˆ10K-50Kï¼‰ç¨³å®šæ€§æœ€ä¼˜ï¼ˆRSD < 10%ï¼‰
   - âš ï¸ å¤§æ‰¹é‡ï¼ˆ100K WAL OFFï¼‰ååç•¥é™ä¸” RSD å›å‡
   - é€‚ç”¨åœºæ™¯ï¼šæ‰¹é‡å¤§å°å¯é¢„æµ‹ã€è¿½æ±‚æè‡´ç¨³å®šæ€§

2. **Adaptiveï¼ˆè‡ªé€‚åº”ï¼‰**:
   - âœ… ä¸­æ‰¹é‡ï¼ˆ50Kï¼‰è¡¨ç°æœ€å‡è¡¡ï¼ˆWAL OFF +7.4%ï¼ŒWAL ON +17.8%ï¼‰
   - âœ… è‡ªåŠ¨æ¢æµ‹æœ€ä¼˜ chunkï¼Œæ— éœ€äººå·¥è°ƒå‚
   - âš ï¸ 100K WAL ON æ—¶ RSD è¾ƒé«˜ï¼ˆéœ€è¿›ä¸€æ­¥è°ƒä¼˜çª—å£æˆ–é˜ˆå€¼ï¼‰
   - é€‚ç”¨åœºæ™¯ï¼šæ‰¹é‡å¤§å°å¤šå˜ã€éœ€è‡ªåŠ¨é€‚é…å·¥ä½œè´Ÿè½½

3. **Monolithicï¼ˆå•ä½“ï¼‰**:
   - âš ï¸ RSD æ™®éè¾ƒé«˜ï¼ˆ12-20%ï¼‰ï¼Œflush/compaction æŠ–åŠ¨æ˜æ˜¾
   - ä»…åœ¨å°‘æ•°åœºæ™¯ï¼ˆ100K WAL ONï¼‰RSD æœ€ä½ï¼ˆ3.4%ï¼‰ï¼Œä½†ä¸ç¨³å®š

### 4.3 æ€§èƒ½ç›®æ ‡è¾¾æˆæ€»ç»“

**Week 2 ç›®æ ‡**: æ‰¹é‡å†™å…¥ > 200K ops/sï¼ŒRSD < 15%

| åœºæ™¯ | ç­–ç•¥ | å®æµ‹ QPS | å®æµ‹ RSD | ç›®æ ‡è¾¾æˆ |
|------|------|----------|----------|----------|
| 10K WAL OFF | Chunked | 754K | 0.26% | âœ…âœ…âœ… (åå +277%, RSD -98%) |
| 50K WAL ON | Adaptive | 646K | 12.23% | âœ…âœ… (åå +223%, RSD è¾¾æ ‡) |
| 100K WAL OFF | Adaptive (v2) | 860K | 24.79% | âœ… (åå +330%, RSD ç•¥é«˜) |

**ç»“è®º**:
- âœ… æ‰€æœ‰åœºæ™¯ååå‡ **è¶…ç›®æ ‡ 2-4 å€**
- âœ… å°/ä¸­æ‰¹é‡ RSD ä¼˜å¼‚ï¼ˆ< 15%ï¼‰
- âš ï¸ å¤§æ‰¹é‡ï¼ˆ100Kï¼‰RSD ä»æœ‰ä¼˜åŒ–ç©ºé—´ï¼ˆå¯é€šè¿‡åŠ å¤§çª—å£æˆ–åŠ¨æ€é˜ˆå€¼æ”¹å–„ï¼‰
- ğŸ“Š **æ¨èé…ç½®**: 50K ä»¥ä¸‹ç”¨ Chunkedï¼Œ50K ä»¥ä¸Šç”¨ Adaptive v2

### 4.4 æ•°æ®æ–‡ä»¶

- è‡ªé€‚åº”åŸºå‡†ç»“æœ: `adaptive_bench_results.csv`
- ç­–ç•¥å¯¹æ¯”ç»“æœ: `adaptive_compare_results.csv`
- ç¤ºä¾‹ä»£ç :
  - `examples/rocksdb_adaptive_batch_bench.rs` (æ”¯æŒç¯å¢ƒå˜é‡é…ç½®)
  - `examples/rocksdb_adaptive_compare.rs` (ä¸‰ç­–ç•¥åŒåœºå¯¹æ¯”)

---

## 5. ç»“è®ºä¸åç»­

- ç»“è®ºï¼šå½“å…³é”®åˆ†ç»„å›å½’ < 5% æ—¶ï¼Œæ»¡è¶³ L0 åˆå…¥æ€§èƒ½é—¨æ§›ã€‚
- åç»­ï¼š
	1) CI å®Œæˆåæ›´æ–°ä¸Šè¡¨ä¸ºæœ€ç»ˆå€¼ï¼›
	2) åœ¨ PR ä¸­é™„ä¸Šæœ¬é¡µé“¾æ¥ï¼›
	3) åˆå¹¶åˆ° main åï¼Œä½œä¸ºæ–°çš„åŸºçº¿ç»§ç»­è·Ÿè¸ªã€‚

---

## 6. Phase 4.3 æ–°å¢åŸºå‡† (2025-11-08)

> æœ¬èŠ‚è®°å½• Phase 4.3 å®Œæˆåçš„æ–°åŠŸèƒ½æ€§èƒ½éªŒè¯ç»“æœã€‚

### 6.1 RetryPolicy æ€§èƒ½åŸºå‡†

**æµ‹è¯•åœºæ™¯**: æ¨¡æ‹Ÿå†²çªåœºæ™¯ä¸‹çš„é‡è¯•ç­–ç•¥æ€§èƒ½å¼€é”€

**é…ç½®**:
- æµ‹è¯•è¿­ä»£: 1000 æ¬¡
- å¤±è´¥æ¬¡æ•°: æ¯æ¬¡æ“ä½œå¤±è´¥ 3 æ¬¡åæˆåŠŸ
- é‡è¯•ç­–ç•¥: æŒ‡æ•°é€€é¿ (åŸºç¡€å»¶è¿Ÿ 50Âµs, æœ€å¤§å»¶è¿Ÿ 2ms, é€€é¿å› å­ 2.0, æŠ–åŠ¨ 0.1)

**ç»“æœ**:

| æŒ‡æ ‡ | RetryPolicy | æ‰‹åŠ¨é‡è¯•å¾ªç¯ (åŸºçº¿) |
|---|---:|---:|
| æ€»è¿­ä»£æ¬¡æ•° | 1000 | 1000 |
| æˆåŠŸæ¬¡æ•° | 1000 | 1000 |
| æ€»è€—æ—¶ | 1.80s | 6.80Âµs |
| å¹³å‡å»¶è¿Ÿ | 1.80ms | 6.00ns |
| ååé‡ | 555 ops/sec | 147,058,824 ops/sec |

**æ‰§è¡Œç»Ÿè®¡**:
- æ€»äº‹åŠ¡æ•°: 4000 (1000 æˆåŠŸ + 3000 é‡è¯•)
- æˆåŠŸäº‹åŠ¡: 1000
- å¤±è´¥äº‹åŠ¡: 3000
- é‡è¯•è®¡æ•°: 3000

**åˆ†æ**:
- âœ… RetryPolicy æˆåŠŸå®ç°äº†è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œæ‰€æœ‰æ“ä½œæœ€ç»ˆæˆåŠŸ
- âš ï¸ ç”±äºåŒ…å«çœŸå®çš„å»¶è¿Ÿé€€é¿ï¼ŒRetryPolicy ååé‡æ˜¾è‘—ä½äºæ— å»¶è¿Ÿçš„æ‰‹åŠ¨å¾ªç¯ï¼ˆé¢„æœŸè¡Œä¸ºï¼‰
- âœ… é‡è¯•ç»Ÿè®¡å‡†ç¡®ï¼š1000 æ¬¡æ“ä½œ Ã— 3 æ¬¡å¤±è´¥ = 3000 æ¬¡é‡è¯•
- ğŸ“Š é€‚ç”¨åœºæ™¯ï¼šéœ€è¦é¿å…é›·é¸£ç¾¤æ•ˆåº”çš„é«˜å¹¶å‘å†²çªåœºæ™¯

### 6.2 MVCC Transaction æ€§èƒ½åŸºå‡†

**æµ‹è¯•åœºæ™¯**: MVCC äº‹åŠ¡æäº¤æ€§èƒ½éªŒè¯

**é…ç½®**:
- é¢„å¡«å……: 1000 é”® Ã— 5 ç‰ˆæœ¬ = 5000 æ€»ç‰ˆæœ¬
- åŸºå‡†æµ‹è¯•: 1000 æ¬¡äº‹åŠ¡æäº¤

**ç»“æœ**:

| æŒ‡æ ‡ | å€¼ |
|---|---:|
| æ€»äº‹åŠ¡æ•° | 1000 |
| æˆåŠŸæäº¤ | 1000 (100%) |
| æ€»è€—æ—¶ | 4.12ms |
| **ååé‡** | **242,542 txn/sec** |
| å¹³å‡å»¶è¿Ÿ | 4.12Âµs |

**åˆ†æ**:
- âœ… å•çº¿ç¨‹ MVCC æäº¤è¾¾åˆ° **242K TPS**ï¼Œæ€§èƒ½ä¼˜å¼‚
- âœ… 100% æäº¤æˆåŠŸç‡ï¼Œæ— å†²çªåœºæ™¯ä¸‹ç¨³å®šå¯é 
- ğŸ“Š å¹³å‡å»¶è¿Ÿ 4.12Âµsï¼Œæ»¡è¶³ä½å»¶è¿Ÿéœ€æ±‚
- ğŸ’¡ å¯¹æ¯”ï¼šå¤šçº¿ç¨‹å¹¶è¡Œåœºæ™¯ä¸‹ MVCC å·²éªŒè¯è¾¾åˆ° 290K TPS (è§ 0. é«˜ç«äº‰ TPS å®æµ‹)

### 6.3 é›†æˆæµ‹è¯•é€šè¿‡æƒ…å†µ

**RetryPolicy é›†æˆæµ‹è¯•** (3 tests):
```
âœ… test_retry_backoff_timing ... ok
âœ… test_retry_fatal_error_stops_immediately ... ok
âœ… test_retry_with_jitter ... ok
```

**MVCC Flush Batch é›†æˆæµ‹è¯•** (2 tests):
```
âœ… test_flush_batch_to_rocksdb ... ok
âœ… test_keep_recent_versions_on_flush ... ok
```

### 6.4 ä»£ç è´¨é‡æ”¹è¿›

**ç¼–è¯‘è­¦å‘Šæ¸…ç†**:
- æ¸…ç†å‰: 8 ä¸ªè­¦å‘Š (unused imports, variables, methods, dead_code fields)
- æ¸…ç†å: **0 ä¸ªæ–°è­¦å‘Š** (vm-runtime åŒ…)
- æªæ–½:
  - åˆ é™¤æœªä½¿ç”¨å¯¼å…¥ (metrics.rs, auto_tuner.rs)
  - æ ‡æ³¨ä¿ç•™å­—æ®µ `#[allow(dead_code)]` (commit_lock, bloom_history, WindowStats)
  - ä¿®æ­£ä¸å¿…è¦çš„ `mut` ä¿®é¥°ç¬¦
  - é‡å‘½åæœªä½¿ç”¨å˜é‡ (value â†’ _value)

**ç¤ºä¾‹ç¨‹åºä¿®å¤**:
- âœ… `metrics_http_demo`: ä¿®å¤ header è§£æï¼Œæ›´æ–° metrics API
- âœ… `stability_test_24h`: æ›´æ–°é…ç½®ç»“æ„å’Œ API è°ƒç”¨ï¼Œä¿®æ­£æ ¼å¼åŒ–
- âœ… æ–°å¢ `quick_retry_bench`: å¿«é€ŸéªŒè¯ RetryPolicy æ€§èƒ½
- âœ… æ–°å¢ `quick_flush_bench`: éªŒè¯ MVCC äº‹åŠ¡æ€§èƒ½

### 6.5 å…³é”®æˆæœæ€»ç»“

| åŠŸèƒ½ | çŠ¶æ€ | æ€§èƒ½æŒ‡æ ‡ |
|---|:---:|---|
| RetryPolicy | âœ… | è‡ªåŠ¨é‡è¯•ï¼ŒæŒ‡æ•°é€€é¿ï¼ŒæŠ–åŠ¨æœºåˆ¶ |
| æ‰¹é‡åˆ·å†™ | âœ… | èƒ½åŠ›æ£€æµ‹ + å›é€€æœºåˆ¶ |
| MVCC äº‹åŠ¡ | âœ… | 242K TPS (å•çº¿ç¨‹), 290K TPS (å¤šçº¿ç¨‹é«˜ç«äº‰) |
| é›†æˆæµ‹è¯• | âœ… | 5 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ |
| ä»£ç è´¨é‡ | âœ… | 0 è­¦å‘Šï¼Œç¤ºä¾‹å…¨éƒ¨ä¿®å¤ |

---

**å¤‡æ³¨**: 
- æµ‹è¯•ç¯å¢ƒ: Windows æœ¬åœ°å¼€å‘æœº (release æ¨¡å¼)
- æµ‹è¯•æ—¥æœŸ: 2025-11-08
- åˆ†æ”¯: king/l0-mvcc-privacy-verification
- ç¤ºä¾‹ä»£ç :
  - `src/vm-runtime/examples/quick_retry_bench.rs`
  - `src/vm-runtime/examples/quick_flush_bench.rs`
  - `src/vm-runtime/benches/retry_policy_benchmark.rs`
  - `src/vm-runtime/benches/flush_batch_benchmark.rs`

---

## 7. Benchmark Methodology (æ–¹æ³•è®º & å¯å¤ç°æ€§)

> ç›®çš„ï¼šæ˜ç¡®æŒ‡æ ‡å£å¾„ã€ç¯å¢ƒå‡è®¾ä¸å·¥ä½œè´Ÿè½½æ¨¡å‹ï¼Œé¿å…è¯¯ç”¨ â€œTPSâ€ ä¸å­˜å‚¨ ops/sï¼Œæ”¯æŒåç»­åŒè¡Œè¯„å®¡æˆ–å…¬å¼€å¯¹æ¯”ã€‚

### 7.1 æŒ‡æ ‡å®šä¹‰
| åç§° | è¯´æ˜ | é‡‡é›†æ–¹å¼ |
|------|------|----------|
| TPS(overall) | è‡ªå¯åŠ¨ä»¥æ¥ç´¯è®¡æäº¤äº‹åŠ¡æ•° / è¿è¡Œç§’æ•° | `MetricsCollector::tps()` |
| TPS(window) | æ»šåŠ¨çª—å£(é»˜è®¤1s)å†…æäº¤äº‹åŠ¡æ•° / çª—å£ç§’æ•° | `MetricsCollector::tps_window()` |
| TPS(peak) | è§‚å¯Ÿåˆ°çš„å†å²æœ€å¤§çª—å£ TPS | `MetricsCollector::peak_tps()` |
| success_rate | committed / (committed + aborted) Ã— 100% | åŸå­è®¡æ•°ç»Ÿè®¡ |
| p50/p90/p99 | äº‹åŠ¡å»¶è¿Ÿ(æäº¤è·¯å¾„) ms åˆ†ä½ | æ¡¶ç›´æ–¹å›¾ `LatencyHistogram` |
| ops/s(batch write) | å­˜å‚¨å†™æ“ä½œæ¬¡æ•° / ç§’ (éäº‹åŠ¡) | å„ç­–ç•¥è‡ªå¸¦ç»Ÿè®¡/ç¤ºä¾‹è¾“å‡º |
| GC versions cleaned | GC ä¸€æ¬¡æ¸…ç†çš„ç‰ˆæœ¬æ•° | GC è¿è¡Œæ—¶ç´¯åŠ  |
| RSD | Relative Std Dev (ååç¨³å®šæ€§) | è‡ªé€‚åº”æ‰¹é‡åŸºå‡†è‡ªå¸¦è®¡ç®— |

æ³¨æ„ï¼š`ops/s` ä¸ `TPS` ä¸å¯ç›´æ¥æ¯”è¾ƒï¼›ä¸€æ¬¡äº‹åŠ¡å¯åŒ…å«å¤šä¸ª key å†™å…¥ã€‚å½“å‰ç¤ºä¾‹ä¸­å¤šä¸º 1-key äº‹åŠ¡ï¼Œå±äºâ€œæœ€ç®€å•è·¯å¾„â€æµ‹é‡ã€‚

### 7.2 ç¯å¢ƒè§„èŒƒ
| é¡¹ç›® | è¦æ±‚/è®°å½• |
|------|-----------|
| CPU | å‹å·/ä¸»é¢‘/æ ¸å¿ƒ/çº¿ç¨‹æ•° (ä¾‹: i7-9750H 6C12T @2.60GHz) |
| ç”µæºç­–ç•¥ | å…³é—­èŠ‚èƒ½ (Windows é«˜æ€§èƒ½ / Linux performance governor) |
| ç¼–è¯‘å‚æ•° | `--release`ï¼Œå¯é€‰ LTO/ThinLTO åç»­è¡¥å…… |
| Rust ç‰ˆæœ¬ | `rustc -V` (éœ€åœ¨æŠ¥å‘Šä¸­æ³¨æ˜) |
| ç‰¹æ€§å¼€å…³ | `rocksdb-storage`, Bloom Filter (é»˜è®¤å…³é—­) |
| éšæœºæ€§ | æŒ‡å®šç§å­æˆ–å£°æ˜æœªå›ºå®šéšæœºæº |
| NUMA/äº²å’Œ | åç»­å¯é€‰ï¼šç»‘å®šçº¿ç¨‹åˆ°ç‰©ç†æ ¸å¿ƒï¼Œé¿å…è¿ç§»å¼€é”€ |

### 7.3 å·¥ä½œè´Ÿè½½æ¨¡å‹
| æ¨¡å‹ | æè¿° | å‚æ•°æ¥æº |
|------|------|----------|
| é«˜ç«äº‰ | å¤šçº¿ç¨‹è®¿é—®å°‘é‡çƒ­é”®(å†²çªç‡ 40%~80%) | `concurrent_conflict_bench` |
| ä½ç«äº‰ | å¤§ key ç©ºé—´ + å‡åŒ€è®¿é—® | (è®¡åˆ’åŠ å…¥) |
| æ‰¹é‡å†™å…¥ | å›ºå®š/è‡ªé€‚åº” chunk å†™ RocksDB | `rocksdb_adaptive_*` |
| Bloom è¿‡æ»¤ | æ¨¡æ‹Ÿè¾ƒå¤§è¯»å†™é›†ï¼ŒéªŒè¯è¿‡æ»¤æ”¶ç›Š | `bloom_fair_bench` |
| é•¿è·‘ç¨³å®šæ€§ | æŒç»­è¿è¡Œäº‹åŠ¡ï¼Œè®°å½•æ¼‚ç§»ä¸å³°å€¼ | `mvcc_longrun_bench` (æ–°) |

### 7.4 é•¿è·‘åŸºå‡†ç¤ºä¾‹ (æ–°)
ç¤ºä¾‹å…¥å£ï¼š`cargo run -p vm-runtime --example mvcc_longrun_bench --release`

å¯é…ç½®ç¯å¢ƒå˜é‡ï¼š
| å˜é‡ | é»˜è®¤ | è¯´æ˜ |
|------|------|------|
| `DURATION_SECS` | 600 | æ€»è¿è¡Œç§’æ•° (10 åˆ†é’Ÿ) |
| `INTERVAL_SECS` | 10 | è¾“å‡ºä¸é‡‡æ ·é—´éš” |
| `NUM_THREADS` | 8 | å¹¶å‘æäº¤çº¿ç¨‹æ•° |
| `KEY_SPACE` | 10000 | é”®ç©ºé—´å¤§å°ï¼ˆå½±å“å†²çªæ¦‚ç‡ï¼‰ |
| `WRITE_RATIO` | 100 | å†™äº‹åŠ¡æ¯”ä¾‹ (0~100) |
| `OUT_DIR` | data/longrun | è¾“å‡ºç›®å½• |
| `OUT_FILE` | è‡ªåŠ¨ç”Ÿæˆ | CSV æ–‡ä»¶åï¼ˆå¯è‡ªå®šä¹‰ï¼‰ |

CSV å­—æ®µï¼š`timestamp,elapsed_s,tps,tps_window,tps_peak,success_rate,p50_ms,p90_ms,p99_ms,committed,aborted`

PowerShell å¿«é€Ÿè¿è¡Œè„šæœ¬ï¼š`scripts/run-longrun-bench.ps1`

ç¤ºä¾‹ï¼š
```
powershell -NoProfile -ExecutionPolicy Bypass -File scripts/run-longrun-bench.ps1 -DurationSecs 300 -IntervalSecs 5 -Threads 4 -KeySpace 2000 -WriteRatio 80
```

### 7.5 Caveats (é™åˆ¶ä¸æ³¨æ„)
1. å½“å‰ TPS ä¸ºâ€œæ‰§è¡Œå†…æ ¸ + å†…å­˜ MVCCâ€è·¯å¾„ï¼Œä¸å«ï¼šç½‘ç»œã€ç­¾åéªŒè¯ã€å…±è¯†ã€åŒºå—æ„å»ºã€çŠ¶æ€è†¨èƒ€ã€‚ä¸å¯ä¸å…¬é“¾å…¨è·¯å¾„ TPS ç›´æ¥å¯¹æ¯”ã€‚
2. p50/p90/p99 ä¸ºæ¡¶ç²’åº¦ä¸Šé™è¿‘ä¼¼å€¼ï¼ˆé‡‡ç”¨é¢„å®šä¹‰ ms æ¡¶ï¼‰ï¼ŒçœŸå®å»¶è¿Ÿåˆ†å¸ƒæ›´ç²¾ç»†æ—¶éœ€æ›´ç»†æ¡¶æˆ– HDR Histogramã€‚
3. ops/sï¼ˆæ‰¹é‡å†™ï¼‰å— RocksDB é…ç½®æå¤§å½±å“ï¼ˆWALã€å‹ç¼©ã€å—ç¼“å­˜ï¼‰ï¼›ç»“æœå¿…é¡»æ³¨æ˜é…ç½®ã€‚ç¼ºçœé…ç½®ä¸å¯ç”¨äºæ¨ªå‘æ¯”è¾ƒã€‚
4. Bloom Filter å½“å‰åœºæ™¯ä¸‹è´Ÿæ”¶ç›Šï¼šè¯»å†™é›†è¿‡å°ï¼›å¤§äº‹åŠ¡/å¤šé”®å†™å…¥åœºæ™¯éœ€åç»­ä¸“é—¨åŸºå‡†ã€‚
5. é•¿è·‘åŸºå‡†é»˜è®¤æ—  GC ä¸ flush å‹åŠ›äº‹ä»¶æ³¨å…¥ï¼›åç»­åº”åŠ å…¥å‘¨æœŸæ€§ GC/Flush ä»¥è§‚å¯ŸæŠ–åŠ¨ã€‚

### 7.6 åç»­æ‰©å±•è®¡åˆ’
| ç¼–å· | é¡¹ç›® | æè¿° |
|------|------|------|
| M1 | HDR Histogram é›†æˆ | ç²¾ç»†å»¶è¿Ÿåˆ†å¸ƒ & P999 |
| M2 | CPU äº²å’Œ/NUMA ç­–ç•¥ | å‡å°‘çº¿ç¨‹è¿ç§»æŠ–åŠ¨ |
| M3 | æ ‡å‡†å·¥ä½œè´Ÿè½½å¥—ä»¶ | å¼•å…¥ YCSB / TPC-C å­é›† |
| M4 | GC/Flush å¹²æ‰°æ³¨å…¥ | é•¿è·‘æŠ–åŠ¨ä¸å°¾å»¶è¿Ÿåˆ†æ |
| M5 | åˆ†ç‰‡/è·¯ç”±å¹¶è¡Œæ‰©å±• | å¤šåˆ†åŒºä¸‹çš„ååçº¿æ€§å¢é•¿éªŒè¯ |

---

**å½“å‰æ–¹æ³•è®ºçŠ¶æ€**: åŸºæœ¬æŒ‡æ ‡ä¸æ»šåŠ¨çª—å£å·²å»ºç«‹ï¼›é•¿è·‘ä¸æ‰¹é‡è„šæœ¬é½å¤‡ï¼›ç­‰å¾…åç»­æ‰©å±• (M1~M5) é€æ­¥è¿­ä»£ã€‚

---

## 8. Quick Benchesï¼ˆå¿«é€ŸåŸºå‡†è„šæœ¬ä¸ CIï¼‰

ç›®çš„ï¼šåœ¨æœ¬åœ°æˆ– CI ä¸Šå¿«é€Ÿè·å¾—â€œé‡è¯•ç­–ç•¥å¾®åŸºå‡†â€å’Œâ€œMVCC æäº¤ååâ€ä¸¤ä¸ªè½»é‡æŒ‡æ ‡ï¼Œä½œä¸ºæ—¥å¸¸å›å½’çš„å¥åº·ä¿¡å·ï¼Œä¸æ›¿ä»£ä¸¥æ ¼ Criterion æˆ–é•¿è·‘åŸºå‡†ã€‚

### 8.1 æœ¬åœ°è„šæœ¬
è„šæœ¬ï¼š`scripts/run-quick-benches.ps1`

è¾“å‡ºï¼š
- `data/quick_bench/quick_retry_bench-output.txt`
- `data/quick_bench/quick_flush_bench-output.txt`
- `data/quick_bench/summary.md`

ä½¿ç”¨ï¼š
```
powershell -NoProfile -ExecutionPolicy Bypass -File scripts/run-quick-benches.ps1 -OutDir data/quick_bench
```

### 8.2 CI å·¥ä½œæµ
å·¥ä½œæµæ–‡ä»¶ï¼š`.github/workflows/quick-benches.yml`

è§¦å‘ï¼š
- æ‰‹åŠ¨ `workflow_dispatch`
- å¯¹ `scripts/run-quick-benches.ps1`ã€quick_* ç¤ºä¾‹å˜æ›´çš„ push

äº§ç‰©ï¼š
- Artifact åç§° `quick-bench-results`ï¼ŒåŒ…å« `data/quick_bench/` ç›®å½•ï¼ˆåŸå§‹è¾“å‡ºä¸ summary.mdï¼‰

å¤‡æ³¨ï¼šQuick Benches ç”¨äºå¿«é€Ÿâ€œæ˜¯å¦é€€åŒ–â€çš„çº¢çº¿æ£€æµ‹ï¼›æœ€ç»ˆæ€§èƒ½é™ˆè¿°ä»¥ç¬¬ 0 èŠ‚/4 èŠ‚/7 èŠ‚æ–¹æ³•è®ºä¸æ ‡å‡†åŒ–åŸºå‡†ä¸ºå‡†ã€‚
